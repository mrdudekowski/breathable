# –ü—Ä–æ–±–ª–µ–º—ã –≤ –ª–æ–≥–∏–∫–µ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ü–∏–∫–ª–∞ —Ä–∞—É–Ω–¥–∞ —Å—Ä–∞–∑—É –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–∏–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–Ω–∞ –≤–¥–æ—Ö–µ), –Ω–æ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç—Ç–∞–ø—ã –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è. –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `iceman-technique.md`, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:

1. –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–¥–æ—Ö —Ä–∞—É–Ω–¥–∞
2. **–ó–µ–ª—ë–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞** (round-exhale) - 30/60/90 —Å–µ–∫
3. **–í–¥–æ—Ö** (inhale)
4. **–°–∏–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞** (round-inhale –∏–ª–∏ global-inhale) - 15 —Å–µ–∫
5. **–í—ã–¥–æ—Ö** (exhale)
6. **–ü–∞—É–∑–∞** (pause) - 4 —Å–µ–∫

## –°–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ

**–§–∞–π–ª:** `src/hooks/useBreathingExercise.ts`  
**–°—Ç—Ä–æ–∫–∏:** 401-419

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–ª—è –õ–Æ–ë–û–ì–û –≤–¥–æ—Ö–∞, –∫–æ–≥–¥–∞ `roundCycle === cycles` –∏ `finalHoldPhase === 'exhale'`. –ù–æ —ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (round-exhale).

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
if (prevState.currentPhase === 'inhale' && currentRound && practice.globalInhaleHoldDuration !== undefined) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤–¥–æ—Ö –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –Ω–∞ –≤—ã–¥–æ—Ö–µ
  // (—ç—Ç–æ –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ —Ç–æ–º—É, —á—Ç–æ roundCycle === cycles –∏ finalHoldPhase === 'exhale')
  if (prevState.roundCycle === currentRound.cycles && currentRound.finalHoldPhase === 'exhale') {
    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–ª—è –õ–Æ–ë–û–ì–û –≤–¥–æ—Ö–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ü–∏–∫–ª–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –º—ã –Ω–µ –ø—Ä–æ—à–ª–∏ —á–µ—Ä–µ–∑ –∑–µ–ª—ë–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –º—ã –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ü–∏–∫–ª–µ –∏ –¥–µ–ª–∞–µ–º –æ–±—ã—á–Ω—ã–π –≤–¥–æ—Ö (–Ω–µ –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏), —ç—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∂–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –º—ã —Å—Ä–∞–∑—É –ø–µ—Ä–µ–π–¥—ë–º –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ, –ø—Ä–æ–ø—É—Å–∫–∞—è –∑–µ–ª—ë–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Ñ–∞–∑–∞ –±—ã–ª–∞ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π:
```typescript
if (prevState.currentPhase === 'inhale' && currentRound && practice.globalInhaleHoldDuration !== undefined) {
  if (prevState.roundCycle === currentRound.cycles && 
      currentRound.finalHoldPhase === 'exhale' &&
      prevState.previousHoldType === 'round-exhale') { // –î–û–ë–ê–í–ò–¢–¨ –≠–¢–£ –ü–†–û–í–ï–†–ö–£
    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ
  }
}
```

---

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #2: –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è previousHoldType –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –æ—Ç –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –∫ –≤–¥–æ—Ö—É

**–§–∞–π–ª:** `src/hooks/useBreathingExercise.ts`  
**–°—Ç—Ä–æ–∫–∏:** 66-84 (—Ñ—É–Ω–∫—Ü–∏—è `handleGreenHoldCompletion`)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ö–æ–≥–¥–∞ –º—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –æ—Ç –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (round-exhale) –∫ –≤–¥–æ—Ö—É, –º—ã –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ–º `previousHoldType = 'round-exhale'`. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–æ–≥–¥–∞ –º—ã –Ω–∞ –≤–¥–æ—Ö–µ –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏, –º—ã –Ω–µ –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
const handleGreenHoldCompletion = (
  prevState: ExerciseState,
  practice: BreathingPracticeConfig,
  currentRound: BreathingRoundConfig
): PhaseTransitionResult => {
  const inhaleDuration = resolvePhaseDurationWithSpeed('inhale', practice, currentRound);
  return {
    nextState: {
      ...prevState,
      currentPhase: 'inhale',
      phaseTimeRemaining: inhaleDuration,
      totalTimeElapsed: prevState.totalTimeElapsed + 1,
      currentHoldType: undefined,
      // –û–¢–°–£–¢–°–¢–í–£–ï–¢: previousHoldType: 'round-exhale'
    },
    // ...
  };
};
```

**–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∏–ø –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –∫–∞–∫ previousHoldType:
```typescript
return {
  nextState: {
    ...prevState,
    currentPhase: 'inhale',
    phaseTimeRemaining: inhaleDuration,
    totalTimeElapsed: prevState.totalTimeElapsed + 1,
    currentHoldType: undefined,
    previousHoldType: 'round-exhale', // –î–û–ë–ê–í–ò–¢–¨
  },
  // ...
};
```

---

### üü° –ü–†–û–ë–õ–ï–ú–ê #3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ getNextStateOnTick

**–§–∞–π–ª:** `src/hooks/useBreathingExercise.ts`  
**–°—Ç—Ä–æ–∫–∏:** 195-420

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `getNextStateOnTick` –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ç–æ–º—É, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 401-419) —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –î–û —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –∑–µ–ª—ë–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞.

**–¢–µ–∫—É—â–∏–π –ø–æ—Ä—è–¥–æ–∫:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞—É–∑—ã (—Å—Ç—Ä–æ–∫–∞ 198)
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è hold (—Å—Ç—Ä–æ–∫–∞ 203) - –∑–¥–µ—Å—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∑–µ–ª—ë–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è exhale (—Å—Ç—Ä–æ–∫–∞ 338) - –∑–¥–µ—Å—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–µ
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è inhale –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 401) - –∑–¥–µ—Å—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–≥–¥–∞ –º—ã –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –≤—ã–¥–æ—Ö–µ (roundCycle === cycles - 1), –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–¥–æ—Ö–∞ –º—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–µ (roundCycle —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è cycles). –ù–æ –µ—Å–ª–∏ –º—ã –Ω–∞ –≤–¥–æ—Ö–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ü–∏–∫–ª–µ (roundCycle === cycles), –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ 401-419 —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –î–û —Ç–æ–≥–æ, –∫–∞–∫ –º—ã –ø—Ä–æ—à–ª–∏ —á–µ—Ä–µ–∑ –∑–µ–ª—ë–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏, –¥–æ–±–∞–≤–∏–≤ –ø—Ä–æ–≤–µ—Ä–∫—É `previousHoldType === 'round-exhale'` (—Å–º. –ø—Ä–æ–±–ª–µ–º—É #1).

---

### üü° –ü–†–û–ë–õ–ï–ú–ê #4: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è previousHoldType

**–§–∞–π–ª:** `src/hooks/useBreathingExercise.ts`  
**–°—Ç—Ä–æ–∫–∏:** 802-804

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ö–æ–≥–¥–∞ –º—ã –≤—ã—Ö–æ–¥–∏–º –∏–∑ –∑–∞–¥–µ—Ä–∂–∫–∏ (prevState.currentPhase === 'hold'), –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º `previousHoldType = prevState.currentHoldType`. –ù–æ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ü–û–°–õ–ï —Ç–æ–≥–æ, –∫–∞–∫ `getNextStateOnTick` —É–∂–µ –≤–µ—Ä–Ω—É–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ç–∏–∫–µ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `previousHoldType`, –Ω–æ –≤ —Ç–µ–∫—É—â–µ–º —Ç–∏–∫–µ –º—ã –Ω–µ –º–æ–∂–µ–º.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
} else if (prevState.currentPhase === 'hold' && prevState.currentHoldType !== undefined) {
  // –ï—Å–ª–∏ –º—ã –≤—ã—Ö–æ–¥–∏–º –∏–∑ –∑–∞–¥–µ—Ä–∂–∫–∏, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ—ë —Ç–∏–ø –∫–∞–∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–π
  nextState.previousHoldType = prevState.currentHoldType;
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ç–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –Ω–æ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ç–∏–∫–µ. –í —Ç–µ–∫—É—â–µ–º —Ç–∏–∫–µ, –∫–æ–≥–¥–∞ –º—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –æ—Ç –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –∫ –≤–¥–æ—Ö—É, `previousHoldType` –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ 401-419 –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å `previousHoldType` –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (handleGreenHoldCompletion, handleBlueHoldCompletion), –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ useEffect.

---

### üü° –ü–†–û–ë–õ–ï–ú–ê #5: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–±—ã—á–Ω—ã–π –≤–¥–æ—Ö –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ü–∏–∫–ª–µ

**–§–∞–π–ª:** `src/hooks/useBreathingExercise.ts`  
**–°—Ç—Ä–æ–∫–∏:** 401-419

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ –Ω–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –æ–±—ã—á–Ω—ã–π –≤–¥–æ—Ö –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ü–∏–∫–ª–µ (–∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∞—Å—Ç—å—é –æ–±—ã—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞) –∏ –≤–¥–æ—Ö –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (–∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ).

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `previousHoldType === 'round-exhale'` (—Å–º. –ø—Ä–æ–±–ª–µ–º—É #1).

---

### üü¢ –ü–†–û–ë–õ–ï–ú–ê #6: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ü–∏–∫–ª–∞

**–§–∞–π–ª:** `src/hooks/useBreathingExercise.ts`  
**–°—Ç—Ä–æ–∫–∏:** 338-376

**–ü—Ä–æ–±–ª–µ–º–∞:**
–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ü–∏–∫–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `prevState.roundCycle === currentRound.cycles - 1`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç "–ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–∏–π —Ü–∏–∫–ª". –ù–æ –∫–æ–≥–¥–∞ –º—ã –∑–∞–≤–µ—Ä—à–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–¥–æ—Ö, `roundCycle` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `cycles`, –∏ –º—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–µ. –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ—á–µ–≤–∏–¥–Ω–æ.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
const newRoundCycle = (prevState.roundCycle ?? 1) + 1;
const isLastCycleInRound = newRoundCycle > currentRound.cycles;

if (isLastCycleInRound) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ü–∏–∫–ª
  if (prevState.roundCycle === currentRound.cycles - 1 && currentRound.finalHoldPhase === 'exhale') {
    // –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –≤—ã–¥–æ—Ö–µ ‚Äî —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ exhale (–∑–µ–ª—ë–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)
  }
}
```

**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–≥–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —á–∏—Ç–∞–µ–º–æ—Å—Ç—å, –¥–æ–±–∞–≤–∏–≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –æ–±—ä—è—Å–Ω—è—é—â–∏–π, –ø–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `cycles - 1`.

---

## –†–µ–∑—é–º–µ

–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ (—Å—Ç—Ä–æ–∫–∞ 401-419) —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–ª—è –õ–Æ–ë–û–ì–û –≤–¥–æ—Ö–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ü–∏–∫–ª–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –º—ã –Ω–µ –ø—Ä–æ—à–ª–∏ —á–µ—Ä–µ–∑ –∑–µ–ª—ë–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ:

1. –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `previousHoldType = 'round-exhale'` –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –æ—Ç –∑–µ–ª—ë–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –∫ –≤–¥–æ—Ö—É
2. –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `previousHoldType === 'round-exhale'` –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å `handleGreenHoldCompletion`**: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `previousHoldType = 'round-exhale'` –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ –≤–¥–æ—Ö—É
2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Å—Ç—Ä–æ–∫–µ 401-419**: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `prevState.previousHoldType === 'round-exhale'` –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–∏–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–µ
3. **–£–ª—É—á—à–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –æ–±—ä—è—Å–Ω—è—é—â–∏–µ –ª–æ–≥–∏–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ü–∏–∫–ª–∞

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:
1. –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–¥–æ—Ö —Ä–∞—É–Ω–¥–∞ (roundCycle: cycles - 1 ‚Üí cycles)
2. –ó–µ–ª—ë–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (round-exhale) - 30/60/90 —Å–µ–∫
3. –í–¥–æ—Ö (inhale) - previousHoldType = 'round-exhale'
4. –°–∏–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ (round-inhale –∏–ª–∏ global-inhale) - 15 —Å–µ–∫ - –ø—Ä–æ–≤–µ—Ä–∫–∞: previousHoldType === 'round-exhale'
5. –í—ã–¥–æ—Ö (exhale) - previousHoldType = 'round-inhale' –∏–ª–∏ 'global-inhale'
6. –ü–∞—É–∑–∞ (pause) - 4 —Å–µ–∫ - –ø—Ä–æ–≤–µ—Ä–∫–∞: previousHoldType === 'round-inhale' –∏–ª–∏ 'global-inhale'
